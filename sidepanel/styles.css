/* =============================================================================
   Side Panel Styles — ADO to PA Copypaster
   Tab bar, layout, page context banner, admin CRUD panel.
   ============================================================================= */

/* ─── Alpine.js Cloak ──────────────────────────────────────────────────────── */
/*
   [x-cloak] is set by the developer in HTML on elements that should start
   hidden.  Alpine removes this attribute once it has initialised and evaluated
   the element's x-show expression.  Without this CSS rule the attribute has no
   effect and the element would flash visible before Alpine hides it.
   !important is required so this rule beats any other display declarations.
*/
[x-cloak] { display: none !important; }

/* ─── Base Reset & Layout ──────────────────────────────────────────────────── */

*,
*::before,
*::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

/* Chrome Side Panel occupies the full viewport height of its panel window.
   We use a flex column on #app so the tab bar stays fixed at the top and the
   tab content area fills and scrolls the remaining space. */
html,
body {
  height: 100%;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
               "Helvetica Neue", Arial, sans-serif;
  font-size: 14px;
  line-height: 1.5;
  color: #1f2937;       /* near-black — good contrast against white backgrounds */
  background: #ffffff;
}

#app {
  display: flex;
  flex-direction: column;
  height: 100%;
  overflow: hidden;     /* scrolling is per-panel, not the whole app container */
}

/* ─── Tab Bar ──────────────────────────────────────────────────────────────── */

.tab-bar {
  display: flex;
  flex-shrink: 0;       /* never compressed — always visible at the top */
  border-bottom: 1px solid #e5e7eb;
  background: #f9fafb;
}

.tab-btn {
  flex: 1;
  padding: 10px 0;
  background: none;
  border: none;
  /* Bottom border acts as the active indicator — transparent by default. */
  border-bottom: 2px solid transparent;
  font-size: 14px;
  font-weight: 500;
  color: #6b7280;       /* muted grey — inactive tab text */
  cursor: pointer;
  transition: color 0.15s ease, border-color 0.15s ease;
}

.tab-btn:hover {
  color: #374151;       /* slightly darker on hover to signal interactivity */
}

.tab-btn:focus-visible {
  outline: 2px solid #2563eb;
  outline-offset: -2px;
}

/* Active state: brand blue underline + matching text colour */
.tab-btn--active {
  color: #2563eb;
  border-bottom-color: #2563eb;
}

/* ─── Tab Panels ───────────────────────────────────────────────────────────── */

[role="tabpanel"] {
  flex: 1;
  overflow-y: auto;     /* each panel scrolls independently */
  padding: 12px 14px;
}

/* ─── Page Context Banner ──────────────────────────────────────────────────── */
/*
   Three rows — ADO, PA, unsupported — are always in the DOM; Alpine's x-show
   hides the two that don't match the current pageType.  Each row has a distinct
   background tint so the user can instantly identify the current context at a
   glance without reading the text.

   role="status" + aria-live="polite" on the parent means screen readers
   announce a change whenever pageType updates (via TAB_CHANGED push).
*/

.context-banner {
  margin-bottom: 14px;
  border: 1px solid #e5e7eb;
  border-radius: 6px;
  overflow: hidden;     /* clip the row backgrounds to the rounded border */
}

.context-banner__row {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  padding: 10px 12px;
  font-size: 13px;
  line-height: 1.4;
}

/* ADO — light blue tint */
.context-banner__row--ado {
  background: #eff6ff;
  color: #1e40af;
}

/* PowerApps — light green tint */
.context-banner__row--pa {
  background: #f0fdf4;
  color: #166534;
}

/* Unsupported — neutral grey tint */
.context-banner__row--unsupported {
  background: #f9fafb;
  color: #6b7280;
}

.context-dot {
  font-size: 12px;
  flex-shrink: 0;       /* icon never wraps or compresses */
  line-height: 1.6;     /* vertically align with the first line of text */
}

/* ─── Action Buttons  (Phase 7 / 10) ──────────────────────────────────────── */

.action-buttons {
  display: flex;
  flex-direction: row;   /* button and spinner side-by-side */
  align-items: center;
  gap: 10px;
  margin-bottom: 14px;
  flex-wrap: wrap;       /* gracefully stacks on very narrow panels */
}

/* ── Spinner ────────────────────────────────────────────────────────────────
   CSS border-based rotating spinner — no external image or SVG needed.
   The transparent top border creates the "gap" in the spinning ring.
   animation: spin is defined below via @keyframes.
   Matches the visual weight of the .btn elements it sits beside.
*/
.spinner {
  width: 18px;
  height: 18px;
  border: 2px solid #bfdbfe;       /* light-blue track ring */
  border-top-color: #2563eb;       /* brand blue — the "active" segment */
  border-radius: 50%;
  animation: spin 0.7s linear infinite;
  flex-shrink: 0;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* ─── Field Status List  (Phase 7 / 10) ───────────────────────────────────── */

.field-results {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

/* Unordered list that wraps all per-field result rows */
.field-results-list {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

/* ── Individual result row ──────────────────────────────────────────────────
   Each row shows: coloured dot | field label | optional message.
   The left border stripe reinforces the status colour at a glance
   (consistent with the context-banner__row pattern above).
*/
.field-result {
  display: flex;
  align-items: baseline;
  gap: 6px;
  padding: 6px 10px;
  border-radius: 4px;
  border: 1px solid transparent;
  font-size: 13px;
  line-height: 1.4;
}

/* Status dot — a small filled circle coloured by the parent's .status-* class */
.field-result__dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
  margin-top: 3px;   /* align vertically with the first line of text */
  background: currentColor;  /* inherits the text colour set by .status-* */
}

/* Field label — primary text, slightly bolder */
.field-result__label {
  font-weight: 500;
  color: inherit;
}

/* Optional message — muted secondary text (shown for blank / error results) */
.field-result__message {
  font-size: 12px;
  opacity: 0.8;
  color: inherit;
}

/* ── Status colour variants ─────────────────────────────────────────────────
   Three statuses adoReaderMain can produce:
     success — field was read and has a value       → green
     blank   — field was found but empty in ADO     → amber/yellow
     error   — selector failed or unexpected error  → red

   Colour tokens deliberately match the import-message variants already in
   this file (success/error) and the context-banner tokens (ADO/PA tints),
   so the visual vocabulary stays consistent across the panel.
*/

/* success — green, matching import-message--success and context-banner--pa */
.status-success {
  background: #f0fdf4;
  border-color: #bbf7d0;
  color: #166534;
}

/* blank — amber/yellow — field exists but was empty; softer than error */
.status-blank {
  background: #fffbeb;
  border-color: #fde68a;
  color: #92400e;
}

/* error — red, matching import-message--error and .btn--danger */
.status-error {
  background: #fef2f2;
  border-color: #fca5a5;
  color: #dc2626;
}

/* ─── Admin Tab  (Phase 5 – 9) ─────────────────────────────────────────────── */

/* ── Shared button utilities ────────────────────────────────────────────────── */
/*
   .btn is the base for every clickable button in the extension.
   Variants (.btn--primary, .btn--secondary, .btn--danger, .btn--small) are
   composed via additional classes — BEM modifier pattern.
*/

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 6px 12px;
  border-radius: 4px;
  border: 1px solid transparent;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  line-height: 1.4;
  transition: background 0.12s ease, border-color 0.12s ease, color 0.12s ease;
  white-space: nowrap;
}

.btn:focus-visible {
  outline: 2px solid #2563eb;
  outline-offset: 2px;
}

/* Primary — solid blue fill (Save, + Add Mapping) */
.btn--primary {
  background: #2563eb;
  border-color: #2563eb;
  color: #ffffff;
}

.btn--primary:hover:not(:disabled) {
  background: #1d4ed8;
  border-color: #1d4ed8;
}

/* Secondary — outlined, neutral (Cancel, Pick from Page, Export/Import) */
.btn--secondary {
  background: #ffffff;
  border-color: #d1d5db;
  color: #374151;
}

.btn--secondary:hover:not(:disabled) {
  background: #f3f4f6;
  border-color: #9ca3af;
}

/* Danger — red outline (Delete) */
.btn--danger {
  background: #ffffff;
  border-color: #fca5a5;
  color: #dc2626;
}

.btn--danger:hover:not(:disabled) {
  background: #fef2f2;
  border-color: #f87171;
}

/* Small variant — reduced padding for compact list rows */
.btn--small {
  padding: 3px 8px;
  font-size: 12px;
}

/* Disabled state applies to all variants */
.btn:disabled {
  opacity: 0.45;
  cursor: not-allowed;
}

/* ── Screen-reader-only utility ─────────────────────────────────────────────── */
/*
   .sr-only visually hides text while keeping it accessible to screen readers.
   Used on the "Enabled" label text inside the checkbox so sighted users see
   only the checkbox, while assistive technology reads the label.
*/
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* ── Task 9.4 — Settings section (Overwrite Mode) ───────────────────────────── */

.settings-section {
  margin-bottom: 16px;
  padding-bottom: 14px;
  border-bottom: 1px solid #e5e7eb;
}

.settings-section__heading {
  font-size: 13px;
  font-weight: 600;
  color: #374151;
  margin-bottom: 10px;
  letter-spacing: 0.01em;
}

/* Overwrite Mode checkbox row */
.overwrite-mode-label {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  font-size: 13px;
  color: #374151;
  cursor: pointer;
  line-height: 1.4;
}

.overwrite-mode-checkbox {
  flex-shrink: 0;
  width: 14px;
  height: 14px;
  margin-top: 2px; /* visually align with first text line */
  cursor: pointer;
  accent-color: #2563eb;
}

/* ── Task 9.1 — Mapping list row styles ─────────────────────────────────────── */

.mapping-section {
  margin-bottom: 16px;
}

/* Section header row: title on the left, "+ Add Mapping" button on the right */
.mapping-section__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 10px;
}

.mapping-section__title {
  font-size: 12px;
  font-weight: 600;
  color: #6b7280;    /* muted — separator-like visual weight */
  letter-spacing: 0.02em;
}

/* Reset the default list styles — we use <ul role="list"> for accessibility */
.mapping-list {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

/* Each row: info (label + badge) on the left, controls on the right */
.mapping-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 10px;
  background: #f9fafb;
  border: 1px solid #e5e7eb;
  border-radius: 5px;
  gap: 8px;
}

.mapping-row__info {
  display: flex;
  align-items: center;
  gap: 8px;
  min-width: 0;    /* allow text to truncate inside flex */
  flex: 1;
}

.mapping-row__label {
  font-size: 13px;
  font-weight: 500;
  color: #1f2937;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* FieldType badges — pill-shaped with colour per type */
.badge {
  display: inline-block;
  padding: 1px 6px;
  border-radius: 10px;
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 0.03em;
  text-transform: lowercase;
  flex-shrink: 0;
}

/* text — neutral grey (most common type, low visual noise) */
.badge--text {
  background: #f3f4f6;
  color: #6b7280;
  border: 1px solid #e5e7eb;
}

/* lookup — blue (matches the brand colour; lookup implies a relationship) */
.badge--lookup {
  background: #eff6ff;
  color: #1d4ed8;
  border: 1px solid #bfdbfe;
}

/* choice — purple (distinct from lookup; choice is a discrete selection) */
.badge--choice {
  background: #f5f3ff;
  color: #6d28d9;
  border: 1px solid #ddd6fe;
}

/* Controls section: enabled checkbox + Edit + Delete */
.mapping-row__controls {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-shrink: 0;
}

/* Wrapper that makes the entire checkbox area clickable */
.mapping-row__enabled-label {
  display: flex;
  align-items: center;
  cursor: pointer;
  margin: 0;
}

.mapping-row__enabled-checkbox {
  width: 14px;
  height: 14px;
  cursor: pointer;
  accent-color: #2563eb;
}

/* ── Task 9.3 — Empty-state message ─────────────────────────────────────────── */
/*
   Shown when settings.mappings is empty. Muted and centred so it doesn't
   compete visually with the "+ Add Mapping" button.
*/
.empty-state {
  text-align: center;
  font-size: 13px;
  color: #9ca3af;
  padding: 20px 0 12px;
  line-height: 1.5;
}

/* ── Task 9.2 — Mapping form styles ─────────────────────────────────────────── */

.mapping-form {
  margin-top: 12px;
  padding: 14px;
  background: #ffffff;
  border: 1px solid #d1d5db;
  border-radius: 6px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.mapping-form__heading {
  font-size: 14px;
  font-weight: 600;
  color: #111827;
  margin: 0;
}

/* form-group: label + input pair */
.form-group {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.form-group__label {
  font-size: 12px;
  font-weight: 600;
  color: #374151;
  letter-spacing: 0.01em;
}

/* The asterisk inside label spans is aria-hidden — purely decorative */
.form-group__label span[aria-hidden] {
  color: #dc2626;
  margin-left: 2px;
}

/* Text inputs fill the available width */
.form-group__input {
  width: 100%;
  padding: 6px 8px;
  border: 1px solid #d1d5db;
  border-radius: 4px;
  font-size: 13px;
  color: #1f2937;
  background: #ffffff;
  transition: border-color 0.12s ease, box-shadow 0.12s ease;
  box-sizing: border-box;
}

.form-group__input:focus {
  outline: none;
  border-color: #2563eb;
  box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.15);
}

/* Row variant: input + deferred action buttons side by side */
.form-group__row {
  display: flex;
  align-items: center;
  gap: 6px;
}

.form-group__row .form-group__input {
  flex: 1;
  min-width: 0;
}

/* Field Type select — same sizing as text inputs */
.form-group__select {
  width: 100%;
  padding: 6px 8px;
  border: 1px solid #d1d5db;
  border-radius: 4px;
  font-size: 13px;
  color: #1f2937;
  background: #ffffff;
  cursor: pointer;
  transition: border-color 0.12s ease;
  box-sizing: border-box;
}

.form-group__select:focus {
  outline: none;
  border-color: #2563eb;
  box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.15);
}

/* Inline validation error — rendered below the field set, above Save/Cancel */
.inline-error {
  font-size: 12px;
  color: #dc2626;    /* red — standard error colour */
  margin: 0;
  line-height: 1.4;
}

/* Save + Cancel button row */
.mapping-form__actions {
  display: flex;
  gap: 8px;
}

/* ── Export / Import section (Phase 6) ─────────────────────────────────────── */
/*
   Sits at the bottom of the Admin tab. The section wraps the button row and
   the inline feedback message. Border-top visually separates this utility area
   from the mapping list above.
*/
.import-export-section {
  padding-top: 14px;
  margin-top: 6px;
  border-top: 1px solid #e5e7eb;
}

/* Button row — right-aligned so it doesn't compete with the mapping content */
.import-export-bar {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}

/* ── Visually-hidden utility ─────────────────────────────────────────────────
   Positions an element off-screen without using display:none.
   Why not display:none?
     Some browsers do not fire a programmatic .click() on display:none elements,
     which would silently break the Import file picker trigger. Using this class
     instead keeps the element in the layout and accessible to scripts, while
     being invisible and zero-size to the user. (design.md Decision 3)
   Based on the standard .sr-only pattern above. */
.visually-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
  /* No margin: -1px to avoid shifting layout, unlike .sr-only which is
     optimised for text. For a file input, the padding: 0 + 1px size is
     sufficient to keep it out of the visual flow. */
}

/* ── Import feedback message ─────────────────────────────────────────────────
   Displayed below the Import/Export button row after each import attempt.
   Green for success, red for errors. Shown inline (not as a browser dialog)
   per the spec requirement that alert() is never used. (§7.3)
*/
.import-message {
  margin-top: 8px;
  padding: 7px 10px;
  border-radius: 4px;
  font-size: 12px;
  line-height: 1.4;
  font-weight: 500;
}

/* Success — green, matching the PA page-context banner tones */
.import-message--success {
  background: #f0fdf4;
  color: #166534;
  border: 1px solid #bbf7d0;
}

/* Error — red, matching the inline-error / danger button tones */
.import-message--error {
  background: #fef2f2;
  color: #dc2626;
  border: 1px solid #fca5a5;
}
